<?php

namespace App\Console\Commands;

use App\Models\OutSourceTrack;
use App\Providers\OutSourceOSMProvider;
use App\Providers\OutSourceSentieroItaliaProvider;
use Illuminate\Console\Command;
use Illuminate\Support\Facades\DB;
use Illuminate\Support\Facades\Log;

class OutSourceImportCommand extends Command
{
    /**
     * The name and signature of the console command.
     *
     * @var string
     */
    protected $signature = 'geohub:out_source_import 
                            {provider : Select the provider to be used for import (sicai or osm)}';

    /**
     * The console command description.
     *
     * @var string
     */
    protected $description = 'Import data from SICAI';

    /**
     * Create a new command instance.
     *
     * @return void
     */
    public function __construct()
    {
        parent::__construct();
    }

    /**
     * Execute the console command.
     *
     * @return int
     */
    public function handle()
    {
        $provider = $this->argument('provider');
        switch ($provider) {
            case 'sicai':
                $this->handleSicai();
                break;
            case 'osm':
                $this->handleOSM();
                break;

            default:
                Log::error('INVALID PROVIDER');
                break;
        }
    }

    private function handleSicai()
    {
        Log::info('Handling Sentiero Italia Provider');
        $si = app(OutSourceSentieroItaliaProvider::class);
        foreach ($si->getTrackList() as $id) {
            Log::info("Importing track: source_id -> {$id}");
            $os = OutSourceTrack::firstOrCreate([
                'provider' => 'App\Providers\OutSourceSentieroItaliaProvider',
                'type' => 'track',
                'source_id' => $id,
            ]);
            $item = $si->getItem($id);
            $os->tags = $item['tags'];
            $os->geometry = DB::raw("(ST_GeomFromGeoJSON('{$item['geometry']}'))");
            $os->save();
        }

        return 0;
    }

    private function handleOSM()
    {
        Log::info('Handling OSM Provider');
        $provider = app(OutSourceOSMProvider::class);
        foreach ($this->getHardCodedOSMIds() as $id) {
            Log::info("Processing OSMID $id");
            $item = $provider->getItem($id);
            $os = OutSourceTrack::firstOrCreate([
                'provider' => 'App\Providers\OutSourceOSMProvider',
                'type' => 'track',
                'source_id' => $id,
            ]);
            $item = $provider->getItem($id);
            $os->tags = $item['tags'];
            $os->geometry = DB::raw("(ST_GeomFromGeoJSON('{$item['geometry']}'))");
            $os->save();
        }
    }

    private function getHardCodedOSMIds()
    {
        return [
            7744463,
            3523766,
            2858770,
            2858769,
            12183019,
            12204319,
            12204368,
            12204349,
            7744660,
            12212824,
            7775549,
            7775548,
            7775547,
            7775546,
            7775545,
            7775520,
            7774927,
            7774901,
            7768213,
            7768183,
            7768170,
            7766492,
            7752808,
            7752801,
            7744723,
            7744723,
            7744723,
            7744723,
            7744701,
            7744686,
            7744685,
            7744670,
            7744669,
            6850358,
            6610987,
            6610905,
            5878167,
            5878159,
            5878115,
            5554058,
            4575145,
            4545959,
            4545943,
            4005613,
            4005612,
            4005611,
            4005610,
            4005567,
            4005481,
            3997182,
            3997181,
            3997180,
            3997179,
            3997123,
            3997122,
            3997121,
            3997120,
            3997119,
            3997110,
            3997107,
            3980624,
            3926211,
            3926192,
            3841677,
            3280863,
            3280788,
            3280745,
            3280712,
            3208526,
            2858768,
            2759235,
            2759222,
            2759222,
            2759222,
            2759218,
            2759176,
            2740238,
            2707436,
            2707435,
            2707418,
            2699887,
            2695168,
            1776606,
            1750342,
            1750341,
            1750340,
            368264,
            358897,
            357965,
            357963,
            357962,
            357960,
            357959,
            12182650,
            9224686,
            9224458,
            9224458,
            9224961,
            9224597,
            7773335,
            7757091,
            5336010,
            3841676,
            3841675,
            2680853,
            2364471,
            1776605,
            8895796,
            8895796,
            8895796,
            8895796,
            8895796,
            8895796,
            8895796,
            8895796,
            6547857,
            6547874,
            11983043,
            10130900,
            10131870,
            10132325,
            11987210,
            10112753,
            11987134,
            11987144,
            11902586,
            11902509,
            8899006,
            8899006,
            8899006,
            8899006,
            8899006,
            8899006,
            8899006,
            8899006,
            8899006,
            8899006,
            8899006,
            8001413,
            7992889,
            7875396,
            7875395,
            7875373,
            7875372,
            7875356,
            7768233,
            2695916,
            6653712,
            10157081,
            10157078,
            10154955,
            10156862,
            10154454,
            10157266,
            12182313,
            12182292,
            12204589,
            12204589,
            10191054,
            10154884,
            10615297,
            10615147,
            10615255,
            10615253,
            10622709,
            10402374,
            7768197,
            7768196,
            7768182,
            7768171,
            7766565,
            7766562,
            7766553,
            7766553,
            7766553,
            7766552,
            7766535,
            7766534,
            7766524,
            7766518,
            7766509,
            7766508,
            7766503,
            7752916,
            7752916,
            7752916,
            7752851,
            7752850,
            7752849,
            7752826,
            7752825,
            7752824,
            7752810,
            7752800,
            7752718,
            7752717,
            7752717,
            7752717,
            7752717,
            7752717,
            7752717,
            7744432,
            7744402,
            7744402,
            7744402,
            7744331,
            7744330,
            7744308,
            7744291,
            7744290,
            7744215,
            7744214,
            7744214,
            7744214,
            7744214,
            7744214,
            3969910,
            3638678,
            3594385,
            3171729,
            10184177,
            10188505,
            10191514,
            10191544,
            12182469,
            10191545,
            10191549,
            10191548,
            10191547,
            12182759,
            10398273,
            10398272,
            10398271,
            10241303,
            11778178,
            11778178,
            11775870,
            11775867,
            10619862,
            10619736,
            10619735,
            10619662,
            10619661,
            10619608,
            10619607,
            10619545,
            10619544,
            10619543,
            10619536,
            10619535,
            10619534,
            10619533,
            10619378,
            10619359,
            10619272,
            10619227,
            10619207,
            10615615,
            10615592,
            10615577,
            10615548,
            7766502,
            6598014,
            12204676,
            10154790,
            10154790,
            10154790,
            10182917,
            10132441,
            10154190,
            4090844,
            10154964,
            10135728,
            10135728,
            10135728,
            10135728,
            10135728,
            10135728,
            10154096,
            10136017,
            10154530,
            10132445,
            10132445,
            10132445,
            10135886,
            10157606,
            10191546,
            11979571,
            11979571,
            11979571,
            10157333,
            10154443,
            10154443,
            11975324,
            11975324,
            11989731,
            10154429,
            12048515,
            12217870,
            12217870,
            12217870,
            10183048,
            11979591,
            10183842,
            10183773,
            10156814,
            10130793,
            11936461,
            10154977,
            10183055,
            12048388,
            10131831,
            10131823,
            12080743,
            12080277,
            11989780,
            11989780,
            11989780,
            11989780,
            10157230,
            11987257,
            10183708,
            11975595,
            11975586,
            11989592,
            12082238,
            12048463,
            11987260,
            10182886,
            10154918,
            10156887,
            11975400,
            12082782,
            12081035,
            11978889,
            10183004,
            10154658,
            10154749,
            10157279,
            10183103,
            10183180,
            11975581,
            10154118,
            10154118,
            10130785,
            6638823,
            12048464,
            12048601,
            10183571,
            11937014,
            11937014,
            12082273,
            10157546,
            11978785,
            11978977,
            11979619,
            11982247,
            11979683,
            11979660,
            10131839,
            10131839,
            10130881,
            10134846,
            11936455,
            10184088,
            12080872,
            10183630,
            10183066,
            12080314,
            11975615,
            11975602,
            11936846,
            12080740,
            10131842,
            11978822,
            12217803,
            7744586,
            12183135,
            12183135,
            10157532,
            12510568,
            12510588,
            12510598,
            12510604,
            12204920,
            10132390,
            10183560,
            11983130,
            10402679,
            11982266,
            10154450,
            12212807,
            10135628,
            12080298,
            10132422,
            11990066,
            10183195,
            11902576,
            11902445,
            11875805,
            11875767,
            11875696,
            11872390,
            11872317,
            11872282,
            11872098,
            11872098,
            11872010,
            11871946,
            11871812,
            11871692,
            11871681,
            11871619,
            11871570,
            11871389,
            11866379,
            11866305,
            11866304,
            11866246,
            11836003,
            11835980,
            11835554,
            11835523,
            11835416,
            11835267,
            11835193,
            11835135,
            11835106,
            11830986,
            11830787,
            11830741,
            11829591,
            11829354,
            11829097,
            11828387,
            11828249,
            11828182,
            11827892,
            11827856,
            11823852,
            11823143,
            11822687,
            11822641,
            11804435,
            11804402,
            11804384,
            10402726,
            10402690,
            10402662,
            10402661,
            10402547,
            10402512,
            10402266,
            10402209,
            10402092,
            10402067,
            10402033,
            10398666,
            10398416,
            10398374,
            10398341,
            10398219,
            10394938,
            10394887,
            10394864,
            10394723,
            10233253,
            10233252,
            10157328,
            10157318,
            10157294,
            7875376,
            6610906,
            3838956,
            3468542,
            2990694,
            2698309,
            2698301,
            358900,        ];
    }
}
